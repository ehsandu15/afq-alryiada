<script setup lang="ts">
import type { NuxtError } from "#app";
import { STRAPI_ENDPOINT } from "./constants/strapi-endpoints";
import type { AppFooterType } from "./types/footer";
import type { AppHeaderType } from "./types/header";
import type { NavigationLinkType } from "./types/shared";

const props = defineProps({
  error: Object as () => NuxtError,
});

const handleError = () => clearError({ redirect: "/" });

console.log("error :", props.error);

const { findOne, find } = useStrapi<AppFooterType>();

const config = useRuntimeConfig();

const { data: footerContent } = await useAsyncData(
  STRAPI_ENDPOINT.APP_FOOTER,
  () =>
    findOne(STRAPI_ENDPOINT.APP_FOOTER, {
      locale: "ar-SA",
      populate: {
        logo: true,
        ctaBtn: true,
        privacyPolicyLink: true,
        social_medias: {
          populate: ["icon"],
        },
      },
    }),
);

const currentActiveSectionId = ref("#");
const { data: navigationLinks } = await useAsyncData(
  STRAPI_ENDPOINT.NAVIGATION_LINKS,
  () =>
    find<NavigationLinkType>(STRAPI_ENDPOINT.NAVIGATION_LINKS, {
      locale: "ar-SA",
      sort: "order:asc",
    }),
);

const { data: headerContent } = await useAsyncData(
  STRAPI_ENDPOINT.APP_HEADER,
  () =>
    findOne<AppHeaderType>(STRAPI_ENDPOINT.APP_HEADER, {
      locale: "ar-SA",
      populate: {
        ctaBtn: true,
        logo: {
          populate: {
            icon: true,
          },
        },
      },
    }),
);
</script>

<template>
  <LayoutAppHeader
    :content="headerContent?.data"
    :navigation-links="navigationLinks?.data"
    :current-active-section-id="currentActiveSectionId"
  />
  <section
    class="app-container container flex flex-col items-center justify-center gap-3 self-center justify-self-center pt-16"
  >
    <figure class="flex w-full items-center justify-center">
      <!-- internal error svg picture -->
      <svg
        v-if="error?.statusCode === 500"
        width="334"
        height="118"
        viewBox="0 0 334 118"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M43.9969 117.2C35.9861 117.2 28.0301 116.158 20.1289 114.073C12.3375 111.878 5.64351 108.805 0.046875 104.855L10.5817 84.4434C14.9712 87.6258 20.0192 90.1498 25.7256 92.0153C31.5417 93.8809 37.4127 94.8136 43.3385 94.8136C50.0325 94.8136 55.3 93.4968 59.1408 90.8631C62.9816 88.2294 64.902 84.5531 64.902 79.8344C64.902 76.8715 64.1339 74.2378 62.5975 71.9333C61.0612 69.6288 58.3178 67.873 54.3672 66.6658C50.5264 65.4587 45.0943 64.8552 38.0711 64.8552H8.60644L14.5323 0H84.8195V21.3989H24.0795L37.9065 9.21799L33.7913 55.4726L19.9643 43.2917H44.3262C55.7389 43.2917 64.902 44.8829 71.8155 48.0653C78.8388 51.1379 83.9416 55.3628 87.124 60.74C90.3064 66.1172 91.8976 72.2076 91.8976 79.0114C91.8976 85.8151 90.1966 92.1251 86.7948 97.9412C83.3929 103.648 78.1255 108.311 70.9925 111.933C63.9693 115.444 54.9707 117.2 43.9969 117.2Z"
          fill="#244453"
        />
        <path
          d="M139.347 110.051C132.015 105.42 126.274 98.7144 122.125 89.932C117.973 81.1522 115.898 70.6755 115.898 58.5006C115.898 46.3271 117.973 35.8504 122.125 27.0693C126.274 18.2895 132.015 11.5828 139.347 6.94912C146.677 2.31814 155.034 0 164.413 0C173.792 0 182.146 2.31814 189.479 6.94912C196.809 11.5828 202.549 18.2895 206.701 27.0693C210.85 35.8504 212.927 46.3271 212.927 58.5006C212.927 70.6755 210.85 81.1522 206.701 89.932C202.549 98.7144 196.809 105.42 189.479 110.051C182.146 114.684 173.792 117 164.413 117C155.034 117 146.677 114.684 139.347 110.051Z"
          fill="#244453"
        />
        <path
          d="M168.445 22.1881C164.23 19.8116 157.802 21.2476 155.805 25.4904C153.806 29.7346 169.368 35.6081 172.556 32.5124C175.666 28.8113 171.879 24.1419 168.445 22.1881Z"
          fill="#F5F5FF"
        />
        <path
          d="M194.843 43.5758C194.169 37.3168 184.457 32.5732 184.459 41.5915C184.461 43.9467 185.196 47.0517 187.303 48.4399C190.629 50.6336 195.261 47.4597 194.843 43.5758Z"
          fill="#F5F5FF"
        />
        <path
          d="M162.193 116.951C162.928 116.98 163.666 117 164.413 117C173.792 117 182.146 114.684 189.479 110.051C196.809 105.42 202.549 98.7144 206.701 89.932C210.765 81.331 212.837 71.0996 212.92 59.2413C210.182 61.2138 207.647 63.5941 205.5 66.4024C196.18 77.1559 188.949 73.4442 176.503 65.6725C164.058 57.9008 146.489 43.6118 130.032 51.4232C122.696 55.8343 127.134 65.658 132.682 68.9378C148.746 77.9362 128.38 82.5897 143.32 95.4891C149.271 100.333 165.487 104.811 162.925 114.954C162.755 115.623 162.477 116.287 162.193 116.951Z"
          fill="#C5C0FF"
        />
        <path
          d="M197.46 84.2574C202.937 83.607 207.02 81.5339 210.536 79.176C212.076 73.1423 212.87 66.4951 212.92 59.2413C210.182 61.2138 207.647 63.5941 205.5 66.4024C196.18 77.1559 188.949 73.4442 176.503 65.6725C164.058 57.9008 146.489 43.6118 130.032 51.4232C122.696 55.8343 127.134 65.658 132.682 68.9378C147.506 77.2407 131.311 81.8452 140.458 92.6411C140.786 90.0965 141.387 87.1425 142.484 83.9554C144.177 79.033 146.245 73.0217 150.091 70.4399C160.454 63.4789 175.642 86.8471 197.46 84.2574Z"
          fill="#F5F5FF"
        />
        <path
          d="M260.374 110.051C253.042 105.42 247.301 98.7144 243.152 89.932C239 81.1522 236.926 70.6755 236.926 58.5006C236.926 46.3271 239 35.8504 243.152 27.0693C247.301 18.2895 253.042 11.5828 260.374 6.94912C267.704 2.31814 276.061 0 285.441 0C294.819 0 303.173 2.31814 310.506 6.94912C317.836 11.5828 323.576 18.2895 327.728 27.0693C331.877 35.8504 333.954 46.3271 333.954 58.5006C333.954 70.6755 331.877 81.1522 327.728 89.932C323.576 98.7144 317.836 105.42 310.506 110.051C303.173 114.684 294.819 117 285.441 117C276.061 117 267.704 114.684 260.374 110.051Z"
          fill="#244453"
        />
        <path
          d="M289.473 22.1881C285.257 19.8116 278.83 21.2476 276.832 25.4904C274.833 29.7346 290.395 35.6081 293.583 32.5124C296.693 28.8113 292.906 24.1419 289.473 22.1881Z"
          fill="#F5F5FF"
        />
        <path
          d="M315.87 43.5758C315.196 37.3168 305.484 32.5732 305.487 41.5915C305.488 43.9467 306.224 47.0517 308.33 48.4399C311.656 50.6336 316.289 47.4597 315.87 43.5758Z"
          fill="#F5F5FF"
        />
        <path
          d="M283.221 116.951C283.955 116.98 284.693 117 285.441 117C294.819 117 303.173 114.684 310.506 110.051C317.836 105.42 323.576 98.7144 327.728 89.932C331.792 81.331 333.864 71.0996 333.948 59.2413C331.209 61.2138 328.675 63.5941 326.527 66.4024C317.207 77.1559 309.976 73.4442 297.53 65.6725C285.086 57.9008 267.516 43.6118 251.059 51.4232C243.724 55.8343 248.162 65.658 253.709 68.9378C269.774 77.9362 249.408 82.5897 264.347 95.4891C270.299 100.333 286.515 104.811 283.952 114.954C283.783 115.623 283.504 116.287 283.221 116.951Z"
          fill="#C5C0FF"
        />
        <path
          d="M318.488 84.2574C323.965 83.607 328.048 81.5339 331.563 79.176C333.103 73.1423 333.897 66.4951 333.948 59.2413C331.209 61.2138 328.675 63.5941 326.527 66.4024C317.207 77.1559 309.976 73.4442 297.53 65.6725C285.086 57.9008 267.516 43.6118 251.059 51.4232C243.724 55.8343 248.162 65.658 253.709 68.9378C268.533 77.2407 252.338 81.8452 261.485 92.6411C261.814 90.0965 262.414 87.1425 263.512 83.9554C265.205 79.033 267.272 73.0217 271.118 70.4399C281.481 63.4789 296.67 86.8471 318.488 84.2574Z"
          fill="#F5F5FF"
        />
      </svg>
      <!-- not found svg picture -->
      <svg
        v-if="error?.statusCode === 404"
        width="354"
        height="117"
        viewBox="0 0 354 117"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M105.084 89.3651H86.6494V113.121H61.0989V89.3651H0.132812V71.7511L53.498 0H80.9892L31.5053 68.0342H61.9075V46.8649H86.6494V68.0342H105.084V89.3651Z"
          fill="#244453"
        />
        <path
          d="M151.933 110.051C144.601 105.42 138.86 98.7144 134.711 89.932C130.559 81.1522 128.484 70.6755 128.484 58.5006C128.484 46.3271 130.559 35.8504 134.711 27.0693C138.86 18.2895 144.601 11.5828 151.933 6.94912C159.263 2.31814 167.62 0 176.999 0C186.378 0 194.732 2.31814 202.065 6.94912C209.395 11.5828 215.135 18.2895 219.287 27.0693C223.436 35.8504 225.513 46.3271 225.513 58.5006C225.513 70.6755 223.436 81.1522 219.287 89.932C215.135 98.7144 209.395 105.42 202.065 110.051C194.732 114.684 186.378 117 176.999 117C167.62 117 159.263 114.684 151.933 110.051Z"
          fill="#244453"
        />
        <path
          d="M181.032 22.1881C176.816 19.8116 170.388 21.2476 168.391 25.4904C166.392 29.7346 181.954 35.6081 185.142 32.5124C188.252 28.8113 184.465 24.1419 181.032 22.1881Z"
          fill="#F5F5FF"
        />
        <path
          d="M207.429 43.5758C206.755 37.3168 197.043 32.5732 197.045 41.5915C197.047 43.9467 197.782 47.0517 199.889 48.4399C203.215 50.6336 207.847 47.4597 207.429 43.5758Z"
          fill="#F5F5FF"
        />
        <path
          d="M174.779 116.951C175.514 116.98 176.252 117 176.999 117C186.378 117 194.732 114.684 202.065 110.051C209.395 105.42 215.135 98.7144 219.287 89.932C223.351 81.331 225.423 71.0996 225.506 59.2413C222.768 61.2138 220.233 63.5941 218.086 66.4024C208.766 77.1559 201.535 73.4442 189.089 65.6725C176.644 57.9008 159.075 43.6118 142.618 51.4232C135.282 55.8343 139.72 65.658 145.268 68.9378C161.333 77.9362 140.966 82.5897 155.906 95.4891C161.857 100.333 178.073 104.811 175.511 114.954C175.341 115.623 175.063 116.287 174.779 116.951Z"
          fill="#C5C0FF"
        />
        <path
          d="M210.046 84.2574C215.524 83.607 219.606 81.5339 223.122 79.176C224.662 73.1423 225.456 66.4951 225.506 59.2413C222.768 61.2138 220.233 63.5941 218.086 66.4024C208.766 77.1559 201.535 73.4442 189.089 65.6725C176.644 57.9008 159.075 43.6118 142.618 51.4232C135.282 55.8343 139.72 65.658 145.268 68.9378C160.092 77.2407 143.897 81.8452 153.044 92.6411C153.372 90.0965 153.973 87.1425 155.071 83.9554C156.763 79.033 158.831 73.0217 162.677 70.4399C173.04 63.4789 188.229 86.8471 210.046 84.2574Z"
          fill="#F5F5FF"
        />
        <path
          d="M353.865 89.3651H335.429V113.121H309.879V89.3651H248.913V71.7511L302.278 0H329.769L280.285 68.0342H310.687V46.8649H335.429V68.0342H353.865V89.3651Z"
          fill="#244453"
        />
      </svg>

      <!-- <NuxtImg
        :src="
          error?.statusCode === 404
            ? '/error-404-image.webp'
            : '/error-500-image.webp'
        "
        alt="Error image"
        width="300"
        height="200"
        class="h-full rounded-md"
      /> -->
    </figure>
    <span
      class="mt-14 flex flex-col items-center justify-center gap-5 tablet:gap-16"
    >
      <h2
        class="text-center text-3xl font-medium text-app-black-secondary md:text-4xl lg:text-[60px]"
      >
        {{
          error?.statusCode === 404
            ? "الصفحة التي تبحث عنها غير موجودة"
            : "حدث خطأ ما"
        }}
      </h2>
      <P
        class="text-center text-sm font-normal leading-6 text-app-black-secondary text-opacity-60 tablet:text-base"
      >
        {{
          error?.statusCode === 404
            ? "الصفحة التي تبحث عنها غير موجودة برجاء التجقق من الصفحة التي تريد زيارتها و حاول مرة اخري"
            : "حدث عطل فني في الموقع او انه يوجد خطأ ما اثناء عمل التطبيق"
        }}
      </P>
      <div
        v-if="config.public.env === 'development'"
        class="flex flex-col gap-3 bg-gray-200 px-4 py-6"
      >
        <b>{{ error?.message }}</b>
        <pre>
          <code>
            {{error?.stack}}
          </code>
        </pre>
      </div>
    </span>
    <button @click="handleError" class="btn btn-primary mt-8">
      الرجوع للرئيسية
    </button>
  </section>
  <LayoutAppFooter
    :content="footerContent?.data"
    :navigation-links="navigationLinks?.data"
  />
</template>
